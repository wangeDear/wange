### ~~免迁移扩容~~

采用双倍扩容策略，避免数据迁移。扩容前每个节点的数据，有一半要迁移至一个新增节点中，对应关系比较简单。 具体操作如下 (假设已有 2 个节点 A/B，要双倍扩容至 A/A2/B/B2 这 4 个节点)：

-   无需停止应用服务器；
-   新增两个数据库 A2/B2 作为从库，设置主从同步关系为：A=>A2、B=>B2，直至主从数据同步完毕 (早期数据可手工同步)；
-   调整分片规则并使之生效： 
-   原 `ID%2=0 => A` 改为 `ID%4=0 => A, ID%4=2 => A2`；
-    原 `ID%2=1 => B` 改为 `ID%4=1 => B, ID%4=3 => B2`。
-   解除数据库实例的主从同步关系，并使之生效；
-   此时，四个节点的数据都已完整，只是有冗余 (多存了和自己配对的节点的那部分数据)，择机清除即可 (过后随时进行，不影响业务)。

https://cloud.tencent.com/developer/article/1451045

### 二叉树分库分表（原理待分析）

![](https://blog-1258875084.cos.ap-guangzhou.myqcloud.com/picGoImg202112161020153.png)

https://www.zhuxiaodong.net/2017/sharding-db/

### 分库分表动态扩容（扩容的是服务器）

这里扩容的是指服务器，分库和分表数量不会变化，一开始就按规划好的最大分库分表数量分，例如32 * 32，初始数据库服务器2台，则每台数据库服务器有16分库，32分表，后续扩容增加到4台服务器，则将之前两台服务器中的一半数据迁移到新的机器，并且分表分库各种路由规则不需要变更，只需调整之前配置的数据源地址。

https://www.pianshen.com/article/3155750009/
https://www.jianshu.com/p/9d7716b0562e
https://codeantenna.com/a/yiC0qwdOFu







